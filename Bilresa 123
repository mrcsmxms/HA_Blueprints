blueprint:
  name: IKEA Bilresa Scroll Wheel Remote
  description: >
    Mode 1 – Actions only, mit UI-Gruppen (einklappbar).
  domain: automation

  input:
    mode1_entities:
      name: "Mode 1 – Entities"
      icon: mdi:remote
      collapsed: true
      input:
        mode1_scroll_plus_sensor:
          name: Scroll right sensor
          selector:
            entity:
              domain: sensor

        mode1_scroll_minus_sensor:
          name: Scroll left sensor
          selector:
            entity:
              domain: sensor

        mode1_button_event_entity:
          name: Button event entity
          selector:
            entity:
              domain: event

    mode1_actions:
      name: "Mode 1 – Actions"
      icon: mdi:play-circle-outline
      collapsed: true
      input:
        mode1_press_once:
          name: Press once
          default: []
          selector:
            action:

        mode1_press_twice:
          name: Press twice
          default: []
          selector:
            action:

        mode1_long_hold:
          name: Long hold
          default: []
          selector:
            action:

        mode1_release_after_hold:
          name: Release after hold
          default: []
          selector:
            action:

        mode1_scroll_right:
          name: Scroll right
          default: []
          selector:
            action:

        mode1_scroll_left:
          name: Scroll left
          default: []
          selector:
            action:

mode: parallel
max: 20

trigger:
  - platform: state
    entity_id: !input mode1_button_event_entity
    id: press

  - platform: state
    entity_id: !input mode1_button_event_entity
    attribute: event_type
    to: long_press
    id: long_press

  - platform: state
    entity_id: !input mode1_button_event_entity
    attribute: event_type
    to: long_release
    id: long_release

  - platform: state
    entity_id: !input mode1_scroll_plus_sensor
    to: "1"
    id: scroll_plus

  - platform: state
    entity_id: !input mode1_scroll_minus_sensor
    to: "1"
    id: scroll_minus

action:
  - variables:
      et: "{{ trigger.to_state.attributes.event_type if trigger.to_state else none }}"

  - choose:
      - conditions:
          - condition: trigger
            id: press
        sequence:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ et == 'multi_press_1' }}"
                sequence: !input mode1_press_once

              - conditions:
                  - condition: template
                    value_template: "{{ et == 'multi_press_2' }}"
                sequence: !input mode1_press_twice

      - conditions:
          - condition: trigger
            id: long_press
        sequence: !input mode1_long_hold

      - conditions:
          - condition: trigger
            id: long_release
        sequence: !input mode1_release_after_hold

      - conditions:
          - condition: trigger
            id: scroll_plus
        sequence: !input mode1_scroll_right

      - conditions:
          - condition: trigger
            id: scroll_minus
        sequence: !input mode1_scroll_left

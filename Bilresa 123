blueprint:
  name: IKEA Bilresa Scroll Wheel Remote
  description: >
    Scrollwheel Remote mit einklappbaren UI-Sektionen.
    Mode 1 vollständig umgesetzt.
  domain: automation

  input:

    mode1_entities:
      name: "Mode 1 – Entities"
      icon: mdi:remote
      collapsed: true
      input:

        scroll_plus_sensor:
          name: Scroll right sensor
          selector:
            entity:
              domain: sensor

        scroll_minus_sensor:
          name: Scroll left sensor
          selector:
            entity:
              domain: sensor

        button_event_entity:
          name: Button event entity
          selector:
            entity:
              domain: event

    mode1_actions:
      name: "Mode 1 – Actions"
      icon: mdi:play-circle-outline
      collapsed: true
      input:

        press_once:
          name: Press once
          default: []
          selector:
            action:

        press_twice:
          name: Press twice
          default: []
          selector:
            action:

        long_hold:
          name: Long hold
          default: []
          selector:
            action:

        release_after_hold:
          name: Release after hold
          default: []
          selector:
            action:

        scroll_right:
          name: Scroll right
          default: []
          selector:
            action:

        scroll_left:
          name: Scroll left
          default: []
          selector:
            action:

mode: parallel
max: 20

trigger:
  # Breiter Trigger für Multi-Press (auch gleiche event_type-Werte hintereinander)
  - platform: state
    entity_id: !input mode1_entities.button_event_entity
    id: press

  - platform: state
    entity_id: !input mode1_entities.button_event_entity
    attribute: event_type
    to: long_press
    id: long_press

  - platform: state
    entity_id: !input mode1_entities.button_event_entity
    attribute: event_type
    to: long_release
    id: long_release

  - platform: state
    entity_id: !input mode1_entities.scroll_plus_sensor
    to: "1"
    id: scroll_plus

  - platform: state
    entity_id: !input mode1_entities.scroll_minus_sensor
    to: "1"
    id: scroll_minus

action:
  - variables:
      et: "{{ trigger.to_state.attributes.event_type if trigger.to_state else none }}"

  - choose:

      - conditions:
          - condition: trigger
            id: press
        sequence:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ et == 'multi_press_1' }}"
                sequence: !input mode1_actions.press_once

              - conditions:
                  - condition: template
                    value_template: "{{ et == 'multi_press_2' }}"
                sequence: !input mode1_actions.press_twice

      - conditions:
          - condition: trigger
            id: long_press
        sequence: !input mode1_actions.long_hold

      - conditions:
          - condition: trigger
            id: long_release
        sequence: !input mode1_actions.release_after_hold

      - conditions:
          - condition: trigger
            id: scroll_plus
        sequence: !input mode1_actions.scroll_right

      - conditions:
          - condition: trigger
            id: scroll_minus
        sequence: !input mode1_actions.scroll_left

blueprint:
  name: IKEA Bilresa Scroll Wheel Remote
  description: >
    ⚠️ Important notes for using this Blueprint with the IKEA BILRESA Scroll Wheel Remote ⚠️

    This Blueprint is designed specifically for the IKEA BILRESA Scroll Wheel Remote and relies on entities that are not enabled by default in Home Assistant.
    
    1. Enable sensors and events first
    
    After pairing the BILRESA remote, Home Assistant exposes several sensor and event entities, but most of them are disabled by default.
    Before this Blueprint can work correctly, you must:
    Open the device page of the IKEA BILRESA remote in Home Assistant
    Manually enable all related sensor and event entities
    Without enabling these entities, the Blueprint will not receive any triggers.
    
    2. Numbering scheme (Sensors 1–9)
    
    Home Assistant assigns the BILRESA entities using a fixed numeric scheme, which this Blueprint follows consistently:
    Sensors 1–2 → Scroll wheel (Mode 1, left / right)
    Event 3 → Button press (Mode 1)
    Sensors 4–5 → Scroll wheel (Mode 2, left / right)
    Event 6 → Button press (Mode 2)
    Sensors 7–8 → Scroll wheel (Mode 3, left / right)
    Event 9 → Button press (Mode 3)
    
    This Blueprint is explicitly structured around this numbering.
    When configuring the inputs, make sure you select the entities that match these numbers.
    
    3. Modes and actions
    
    Each mode (1–3) is handled independently:
    
    Single press (multi_press_1)
    Double press (multi_press_2)
    Long press
    Long release
    Scroll left
    Scroll right
    
    All actions are fully user-defined via the Blueprint UI.
    The Blueprint only handles input detection and routing, not the behavior itself.
    
    4. Why this structure is used
    
    The BILRESA remote can emit the same event type multiple times in a row (e.g. two single presses).
    To reliably detect this, the Blueprint uses broad state triggers and evaluates the event_type internally instead of relying on state changes alone.
    This ensures consistent behavior for rapid presses, long presses, and scroll events.
  domain: automation

  input:
    # =======================
    # MODE 1 – SENSOREN & EVENTS
    # =======================
    mode1_sensors_events:
      name: "Mode 1 – Sensoren & Events"
      icon: mdi:numeric-1-circle-outline
      collapsed: true
      input:
        scroll_plus_sensor:
          name: Sensor 1 – Scroll right
          default: ""
          selector:
            entity:
              filter:
                domain: sensor

        scroll_minus_sensor:
          name: Sensor 2 – Scroll left
          default: ""
          selector:
            entity:
              filter:
                domain: sensor

        button_event_entity:
          name: Event 3 – Button
          default: ""
          selector:
            entity:
              filter:
                domain: event

    # =======================
    # MODE 2 – SENSOREN & EVENTS
    # =======================
    mode2_sensors_events:
      name: "Mode 2 – Sensoren & Events"
      icon: mdi:numeric-2-circle-outline
      collapsed: true
      input:
        scroll_plus_sensor_mode2:
          name: Sensor 4 – Scroll right
          default: ""
          selector:
            entity:
              filter:
                domain: sensor

        scroll_minus_sensor_mode2:
          name: Sensor 5 – Scroll left
          default: ""
          selector:
            entity:
              filter:
                domain: sensor

        button_event_entity_mode2:
          name: Event 6 – Button
          default: ""
          selector:
            entity:
              filter:
                domain: event

    # =======================
    # MODE 3 – SENSOREN & EVENTS
    # =======================
    mode3_sensors_events:
      name: "Mode 3 – Sensoren & Events"
      icon: mdi:numeric-3-circle-outline
      collapsed: true
      input:
        scroll_plus_sensor_mode3:
          name: Sensor 7 – Scroll right
          default: ""
          selector:
            entity:
              filter:
                domain: sensor

        scroll_minus_sensor_mode3:
          name: Sensor 8 – Scroll left
          default: ""
          selector:
            entity:
              filter:
                domain: sensor

        button_event_entity_mode3:
          name: Event 9 – Button
          default: ""
          selector:
            entity:
              filter:
                domain: event

    # =======================
    # MODE 1 – ACTIONS
    # =======================
    mode1_actions:
      name: "Mode 1 – Actions"
      icon: mdi:play-circle-outline
      collapsed: true
      input:
        multi_press_1_action:
          name: press once
          default: []
          selector:
            action:

        multi_press_2_action:
          name: press twice
          default: []
          selector:
            action:

        long_press_action:
          name: long hold
          default: []
          selector:
            action:

        long_release_action:
          name: release after hold
          default: []
          selector:
            action:

        scroll_plus_action:
          name: scroll right
          default: []
          selector:
            action:

        scroll_minus_action:
          name: scroll left
          default: []
          selector:
            action:

    # =======================
    # MODE 2 – ACTIONS
    # =======================
    mode2_actions:
      name: "Mode 2 – Actions"
      icon: mdi:play-circle-outline
      collapsed: true
      input:
        multi_press_1_action_mode2:
          name: press once
          default: []
          selector:
            action:

        multi_press_2_action_mode2:
          name: press twice
          default: []
          selector:
            action:

        long_press_action_mode2:
          name: long hold
          default: []
          selector:
            action:

        long_release_action_mode2:
          name: release after hold
          default: []
          selector:
            action:

        scroll_plus_action_mode2:
          name: scroll right
          default: []
          selector:
            action:

        scroll_minus_action_mode2:
          name: scroll left
          default: []
          selector:
            action:

    # =======================
    # MODE 3 – ACTIONS
    # =======================
    mode3_actions:
      name: "Mode 3 – Actions"
      icon: mdi:play-circle-outline
      collapsed: true
      input:
        multi_press_1_action_mode3:
          name: press once
          default: []
          selector:
            action:

        multi_press_2_action_mode3:
          name: press twice
          default: []
          selector:
            action:

        long_press_action_mode3:
          name: long hold
          default: []
          selector:
            action:

        long_release_action_mode3:
          name: release after hold
          default: []
          selector:
            action:

        scroll_plus_action_mode3:
          name: scroll right
          default: []
          selector:
            action:

        scroll_minus_action_mode3:
          name: scroll left
          default: []
          selector:
            action:

mode: parallel
max: 20

trigger:
  # =======================
  # MODE 1
  # =======================
  - platform: state
    entity_id: !input button_event_entity
    id: "1 Druck"

  - platform: state
    entity_id: !input button_event_entity
    attribute: event_type
    to: long_press
    id: "1 gedrückt halten"

  - platform: state
    entity_id: !input button_event_entity
    attribute: event_type
    to: long_release
    id: "1 gedrückt halten loslassen"

  - platform: state
    entity_id: !input scroll_plus_sensor
    to: "1"
    id: "1 scroll +"

  - platform: state
    entity_id: !input scroll_minus_sensor
    to: "1"
    id: "1 scroll -"

  # =======================
  # MODE 2
  # =======================
  - platform: state
    entity_id: !input button_event_entity_mode2
    id: "2 Druck"

  - platform: state
    entity_id: !input button_event_entity_mode2
    attribute: event_type
    to: long_press
    id: "2 gedrückt halten"

  - platform: state
    entity_id: !input button_event_entity_mode2
    attribute: event_type
    to: long_release
    id: "2 gedrückt halten loslassen"

  - platform: state
    entity_id: !input scroll_plus_sensor_mode2
    to: "1"
    id: "2 scroll +"

  - platform: state
    entity_id: !input scroll_minus_sensor_mode2
    to: "1"
    id: "2 scroll -"

  # =======================
  # MODE 3
  # =======================
  - platform: state
    entity_id: !input button_event_entity_mode3
    id: "3 Druck"

  - platform: state
    entity_id: !input button_event_entity_mode3
    attribute: event_type
    to: long_press
    id: "3 gedrückt halten"

  - platform: state
    entity_id: !input button_event_entity_mode3
    attribute: event_type
    to: long_release
    id: "3 gedrückt halten loslassen"

  - platform: state
    entity_id: !input scroll_plus_sensor_mode3
    to: "1"
    id: "3 scroll +"

  - platform: state
    entity_id: !input scroll_minus_sensor_mode3
    to: "1"
    id: "3 scroll -"

action:
  - variables:
      et: "{{ trigger.to_state.attributes.event_type if trigger.to_state else none }}"

  - choose:
      # MODE 1
      - conditions:
          - condition: trigger
            id: "1 Druck"
        sequence:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ et == 'multi_press_1' }}"
                sequence: !input multi_press_1_action
              - conditions:
                  - condition: template
                    value_template: "{{ et == 'multi_press_2' }}"
                sequence: !input multi_press_2_action

      - conditions:
          - condition: trigger
            id: "1 gedrückt halten"
        sequence: !input long_press_action

      - conditions:
          - condition: trigger
            id: "1 gedrückt halten loslassen"
        sequence: !input long_release_action

      - conditions:
          - condition: trigger
            id: "1 scroll +"
        sequence: !input scroll_plus_action

      - conditions:
          - condition: trigger
            id: "1 scroll -"
        sequence: !input scroll_minus_action

      # MODE 2
      - conditions:
          - condition: trigger
            id: "2 Druck"
        sequence:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ et == 'multi_press_1' }}"
                sequence: !input multi_press_1_action_mode2
              - conditions:
                  - condition: template
                    value_template: "{{ et == 'multi_press_2' }}"
                sequence: !input multi_press_2_action_mode2

      - conditions:
          - condition: trigger
            id: "2 gedrückt halten"
        sequence: !input long_press_action_mode2

      - conditions:
          - condition: trigger
            id: "2 gedrückt halten loslassen"
        sequence: !input long_release_action_mode2

      - conditions:
          - condition: trigger
            id: "2 scroll +"
        sequence: !input scroll_plus_action_mode2

      - conditions:
          - condition: trigger
            id: "2 scroll -"
        sequence: !input scroll_minus_action_mode2

      # MODE 3
      - conditions:
          - condition: trigger
            id: "3 Druck"
        sequence:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ et == 'multi_press_1' }}"
                sequence: !input multi_press_1_action_mode3
              - conditions:
                  - condition: template
                    value_template: "{{ et == 'multi_press_2' }}"
                sequence: !input multi_press_2_action_mode3

      - conditions:
          - condition: trigger
            id: "3 gedrückt halten"
        sequence: !input long_press_action_mode3

      - conditions:
          - condition: trigger
            id: "3 gedrückt halten loslassen"
        sequence: !input long_release_action_mode3

      - conditions:
          - condition: trigger
            id: "3 scroll +"
        sequence: !input scroll_plus_action_mode3

      - conditions:
          - condition: trigger
            id: "3 scroll -"
        sequence: !input scroll_minus_action_mode3
